<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4.8 Regression regularization | Lecture notes for Statistical Inference and Machine Learning</title>
  <meta name="description" content="These are the lecture notes for the course Statistical Inference and Machine Learning at the Department of statistics, Uppsala University." />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="4.8 Regression regularization | Lecture notes for Statistical Inference and Machine Learning" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="These are the lecture notes for the course Statistical Inference and Machine Learning at the Department of statistics, Uppsala University." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4.8 Regression regularization | Lecture notes for Statistical Inference and Machine Learning" />
  
  <meta name="twitter:description" content="These are the lecture notes for the course Statistical Inference and Machine Learning at the Department of statistics, Uppsala University." />
  

<meta name="author" content="Patrik Andersson" />


<meta name="date" content="2020-09-07" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="4-7-bias-variance-decomposition.html"/>
<link rel="next" href="4-9-model-selection.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Inference and Machine Learning</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="1-ch-likelihood.html"><a href="1-ch-likelihood.html"><i class="fa fa-check"></i><b>1</b> Likelihood-based methods</a><ul>
<li class="chapter" data-level="1.1" data-path="1-1-maximum-likelihood-estimation.html"><a href="1-1-maximum-likelihood-estimation.html"><i class="fa fa-check"></i><b>1.1</b> Maximum likelihood estimation</a></li>
<li class="chapter" data-level="1.2" data-path="1-2-hypothesis-testing.html"><a href="1-2-hypothesis-testing.html"><i class="fa fa-check"></i><b>1.2</b> Hypothesis testing</a></li>
<li class="chapter" data-level="1.3" data-path="1-3-likelihood-ratio-test.html"><a href="1-3-likelihood-ratio-test.html"><i class="fa fa-check"></i><b>1.3</b> Likelihood ratio test</a></li>
<li class="chapter" data-level="1.4" data-path="1-4-mathematical-aside-taylor-expansion.html"><a href="1-4-mathematical-aside-taylor-expansion.html"><i class="fa fa-check"></i><b>1.4</b> Mathematical aside: Taylor expansion</a></li>
<li class="chapter" data-level="1.5" data-path="1-5-asymptotic-distribution-of-the-mle.html"><a href="1-5-asymptotic-distribution-of-the-mle.html"><i class="fa fa-check"></i><b>1.5</b> Asymptotic distribution of the MLE</a></li>
<li class="chapter" data-level="1.6" data-path="1-6-the-delta-method.html"><a href="1-6-the-delta-method.html"><i class="fa fa-check"></i><b>1.6</b> The delta method</a></li>
<li class="chapter" data-level="1.7" data-path="1-7-wilks-test.html"><a href="1-7-wilks-test.html"><i class="fa fa-check"></i><b>1.7</b> Wilks’ test</a></li>
<li class="chapter" data-level="1.8" data-path="1-8-walds-test.html"><a href="1-8-walds-test.html"><i class="fa fa-check"></i><b>1.8</b> Wald’s test</a></li>
<li class="chapter" data-level="1.9" data-path="1-9-score-test.html"><a href="1-9-score-test.html"><i class="fa fa-check"></i><b>1.9</b> Score test</a></li>
<li class="chapter" data-level="1.10" data-path="1-10-confidence-intervals.html"><a href="1-10-confidence-intervals.html"><i class="fa fa-check"></i><b>1.10</b> Confidence intervals</a></li>
<li class="chapter" data-level="1.11" data-path="1-11-an-application-i.html"><a href="1-11-an-application-i.html"><i class="fa fa-check"></i><b>1.11</b> An application I</a></li>
<li class="chapter" data-level="1.12" data-path="1-12-summary.html"><a href="1-12-summary.html"><i class="fa fa-check"></i><b>1.12</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="2-ch-bootstrap.html"><a href="2-ch-bootstrap.html"><i class="fa fa-check"></i><b>2</b> Bootstrap</a><ul>
<li class="chapter" data-level="2.1" data-path="2-1-parametric-vs-non-parametric.html"><a href="2-1-parametric-vs-non-parametric.html"><i class="fa fa-check"></i><b>2.1</b> Parametric vs non-parametric</a></li>
<li class="chapter" data-level="2.2" data-path="2-2-non-parametric-estimation.html"><a href="2-2-non-parametric-estimation.html"><i class="fa fa-check"></i><b>2.2</b> Non-parametric estimation</a></li>
<li class="chapter" data-level="2.3" data-path="2-3-bootstrap.html"><a href="2-3-bootstrap.html"><i class="fa fa-check"></i><b>2.3</b> Bootstrap</a></li>
<li class="chapter" data-level="2.4" data-path="2-4-parametric-bootstrap.html"><a href="2-4-parametric-bootstrap.html"><i class="fa fa-check"></i><b>2.4</b> Parametric bootstrap</a></li>
<li class="chapter" data-level="2.5" data-path="2-5-an-application-ii.html"><a href="2-5-an-application-ii.html"><i class="fa fa-check"></i><b>2.5</b> An application II</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="3-bayesian-statistics.html"><a href="3-bayesian-statistics.html"><i class="fa fa-check"></i><b>3</b> Bayesian statistics</a><ul>
<li class="chapter" data-level="3.1" data-path="3-1-some-basic-decision-theory.html"><a href="3-1-some-basic-decision-theory.html"><i class="fa fa-check"></i><b>3.1</b> Some basic decision theory</a></li>
<li class="chapter" data-level="3.2" data-path="3-2-bayesian-statistics-1.html"><a href="3-2-bayesian-statistics-1.html"><i class="fa fa-check"></i><b>3.2</b> Bayesian statistics</a></li>
<li class="chapter" data-level="3.3" data-path="3-3-choosing-prior.html"><a href="3-3-choosing-prior.html"><i class="fa fa-check"></i><b>3.3</b> Choosing prior</a></li>
<li class="chapter" data-level="3.4" data-path="3-4-multiparameter-problems.html"><a href="3-4-multiparameter-problems.html"><i class="fa fa-check"></i><b>3.4</b> Multiparameter problems</a></li>
<li class="chapter" data-level="3.5" data-path="3-5-markov-chain-monte-carlo.html"><a href="3-5-markov-chain-monte-carlo.html"><i class="fa fa-check"></i><b>3.5</b> Markov chain monte carlo</a></li>
<li class="chapter" data-level="3.6" data-path="3-6-an-application-iii.html"><a href="3-6-an-application-iii.html"><i class="fa fa-check"></i><b>3.6</b> An application III</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="4-ch-statLearn.html"><a href="4-ch-statLearn.html"><i class="fa fa-check"></i><b>4</b> Statistical learning (draft)</a><ul>
<li class="chapter" data-level="4.1" data-path="4-1-classification.html"><a href="4-1-classification.html"><i class="fa fa-check"></i><b>4.1</b> Classification</a></li>
<li class="chapter" data-level="4.2" data-path="4-2-support-vector-machines-i.html"><a href="4-2-support-vector-machines-i.html"><i class="fa fa-check"></i><b>4.2</b> Support vector machines I</a></li>
<li class="chapter" data-level="4.3" data-path="4-3-hoeffdings-inequality.html"><a href="4-3-hoeffdings-inequality.html"><i class="fa fa-check"></i><b>4.3</b> Hoeffding’s inequality</a></li>
<li class="chapter" data-level="4.4" data-path="4-4-generalization-error.html"><a href="4-4-generalization-error.html"><i class="fa fa-check"></i><b>4.4</b> Generalization error</a></li>
<li class="chapter" data-level="4.5" data-path="4-5-vc-dimension.html"><a href="4-5-vc-dimension.html"><i class="fa fa-check"></i><b>4.5</b> VC-dimension</a></li>
<li class="chapter" data-level="4.6" data-path="4-6-support-vector-machines-ii.html"><a href="4-6-support-vector-machines-ii.html"><i class="fa fa-check"></i><b>4.6</b> Support vector machines II</a></li>
<li class="chapter" data-level="4.7" data-path="4-7-bias-variance-decomposition.html"><a href="4-7-bias-variance-decomposition.html"><i class="fa fa-check"></i><b>4.7</b> Bias-Variance decomposition</a></li>
<li class="chapter" data-level="4.8" data-path="4-8-regression-regularization.html"><a href="4-8-regression-regularization.html"><i class="fa fa-check"></i><b>4.8</b> Regression regularization</a></li>
<li class="chapter" data-level="4.9" data-path="4-9-model-selection.html"><a href="4-9-model-selection.html"><i class="fa fa-check"></i><b>4.9</b> Model selection</a></li>
<li class="chapter" data-level="4.10" data-path="4-10-an-application-iv.html"><a href="4-10-an-application-iv.html"><i class="fa fa-check"></i><b>4.10</b> An application IV</a></li>
<li class="chapter" data-level="4.11" data-path="4-11-an-application-v.html"><a href="4-11-an-application-v.html"><i class="fa fa-check"></i><b>4.11</b> An application V</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="5-beyond-linearity-draft.html"><a href="5-beyond-linearity-draft.html"><i class="fa fa-check"></i><b>5</b> Beyond linearity (draft)</a><ul>
<li class="chapter" data-level="5.1" data-path="5-1-smoothing-splines.html"><a href="5-1-smoothing-splines.html"><i class="fa fa-check"></i><b>5.1</b> Smoothing splines</a></li>
<li class="chapter" data-level="5.2" data-path="5-2-generalized-additive-models.html"><a href="5-2-generalized-additive-models.html"><i class="fa fa-check"></i><b>5.2</b> Generalized additive models</a></li>
<li class="chapter" data-level="5.3" data-path="5-3-neural-networks.html"><a href="5-3-neural-networks.html"><i class="fa fa-check"></i><b>5.3</b> Neural networks</a></li>
<li class="chapter" data-level="5.4" data-path="5-4-stochasitc-gradient-descent.html"><a href="5-4-stochasitc-gradient-descent.html"><i class="fa fa-check"></i><b>5.4</b> Stochasitc gradient descent</a></li>
<li class="chapter" data-level="5.5" data-path="5-5-an-application-vi.html"><a href="5-5-an-application-vi.html"><i class="fa fa-check"></i><b>5.5</b> An application VI</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Lecture notes for Statistical Inference and Machine Learning</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="regression-regularization" class="section level2">
<h2><span class="header-section-number">4.8</span> Regression regularization</h2>
<p>In this section we discuss regularization in the context of regression as a way of controlling overfit.</p>
<p>Recall that in regression we have observations from <span class="math inline">\(\mathbb R^p\)</span> and our task is to predict a value in <span class="math inline">\(\mathbb R\)</span>. We will do this by finding a function <span class="math inline">\(h\in \mathcal H\)</span> that gives a small out-of-sample error
<span class="math display">\[
E_{out} = E_{X,Y}\left[ (Y-h(X))^2 \right].
\]</span>
In linear regression, the collection of functions <span class="math inline">\(\mathcal H\)</span> are the functions of the form
<span class="math display">\[
h(x) = \beta_1x_1 + \cdots + \beta_p x_p,
\]</span>
and we are thus to choose the parameters <span class="math inline">\(\beta_1,\ldots,\beta_p\)</span> in a good way. We know from before that the choice that minimizes the in-sample error is
<span class="math display">\[
\hat\beta = (x^Tx)^{-1}x^Ty.
\]</span>
As we have seen, we may specify some function <span class="math inline">\(\varphi_i\)</span> and use <span class="math inline">\(\varphi_1(x),\ldots,\varphi_M(x)\)</span> to predict <span class="math inline">\(y\)</span> and we are still in the case of linear regression. However we need to be careful not to overfit. Let us see a simple example were <span class="math inline">\(\varphi\)</span> are polynomials. First we construct the functions that will generate our data:</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb121-1" data-line-number="1"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb121-2" data-line-number="2"><span class="kw">library</span>(gridExtra)</a>
<a class="sourceLine" id="cb121-3" data-line-number="3"><span class="kw">library</span>(resample)</a>
<a class="sourceLine" id="cb121-4" data-line-number="4"></a>
<a class="sourceLine" id="cb121-5" data-line-number="5">gen_data &lt;-<span class="st"> </span><span class="cf">function</span>(truth, <span class="dt">n.obs =</span> <span class="dv">100</span>) {</a>
<a class="sourceLine" id="cb121-6" data-line-number="6">  x &lt;-<span class="st"> </span><span class="kw">runif</span>(n.obs, <span class="dt">min =</span> <span class="dv">-2</span>, <span class="dt">max =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb121-7" data-line-number="7">  y &lt;-<span class="st"> </span><span class="kw">truth</span>(x) <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(n.obs) <span class="op">*</span><span class="st"> </span><span class="fl">0.4</span></a>
<a class="sourceLine" id="cb121-8" data-line-number="8">  data.df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">y =</span> y, <span class="dt">x =</span> x)</a>
<a class="sourceLine" id="cb121-9" data-line-number="9">}</a>
<a class="sourceLine" id="cb121-10" data-line-number="10"></a>
<a class="sourceLine" id="cb121-11" data-line-number="11">truth &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb121-12" data-line-number="12">  <span class="kw">sin</span>(x <span class="op">*</span><span class="st"> </span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span>) <span class="op">+</span><span class="st"> </span>x</a>
<a class="sourceLine" id="cb121-13" data-line-number="13">}</a></code></pre></div>
<p>For conveniance, we write a function that fits three different polynomial regressions and returns the plot.</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb122-1" data-line-number="1">fit_plot &lt;-<span class="st"> </span><span class="cf">function</span>(){</a>
<a class="sourceLine" id="cb122-2" data-line-number="2">  data.train.df &lt;-<span class="st"> </span><span class="kw">gen_data</span>(truth)</a>
<a class="sourceLine" id="cb122-3" data-line-number="3"></a>
<a class="sourceLine" id="cb122-4" data-line-number="4">  x.grid &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="fl">0.01</span>)</a>
<a class="sourceLine" id="cb122-5" data-line-number="5">  x.grid.df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> x.grid)</a>
<a class="sourceLine" id="cb122-6" data-line-number="6"></a>
<a class="sourceLine" id="cb122-7" data-line-number="7">  fit1 &lt;-<span class="st"> </span><span class="kw">predict</span>(<span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span><span class="kw">poly</span>(x, <span class="dv">2</span>), data.train.df),</a>
<a class="sourceLine" id="cb122-8" data-line-number="8">                  x.grid.df)</a>
<a class="sourceLine" id="cb122-9" data-line-number="9">  fit2 &lt;-<span class="st"> </span><span class="kw">predict</span>(<span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span><span class="kw">poly</span>(x, <span class="dv">6</span>), data.train.df),</a>
<a class="sourceLine" id="cb122-10" data-line-number="10">                  x.grid.df)</a>
<a class="sourceLine" id="cb122-11" data-line-number="11">  fit3 &lt;-<span class="st"> </span><span class="kw">predict</span>(<span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span><span class="kw">poly</span>(x, <span class="dv">20</span>), data.train.df),</a>
<a class="sourceLine" id="cb122-12" data-line-number="12">                  x.grid.df)</a>
<a class="sourceLine" id="cb122-13" data-line-number="13"></a>
<a class="sourceLine" id="cb122-14" data-line-number="14">  cbp1 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;#999999&quot;</span>, <span class="st">&quot;#E69F00&quot;</span>, <span class="st">&quot;#56B4E9&quot;</span>, <span class="st">&quot;#009E73&quot;</span>,</a>
<a class="sourceLine" id="cb122-15" data-line-number="15">            <span class="st">&quot;#F0E442&quot;</span>, <span class="st">&quot;#0072B2&quot;</span>, <span class="st">&quot;#D55E00&quot;</span>, <span class="st">&quot;#CC79A7&quot;</span>)</a>
<a class="sourceLine" id="cb122-16" data-line-number="16"></a>
<a class="sourceLine" id="cb122-17" data-line-number="17">  p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb122-18" data-line-number="18">    <span class="dt">x =</span> x.grid,</a>
<a class="sourceLine" id="cb122-19" data-line-number="19">    <span class="dt">fit1 =</span> fit1,</a>
<a class="sourceLine" id="cb122-20" data-line-number="20">    <span class="dt">fit2 =</span> fit2,</a>
<a class="sourceLine" id="cb122-21" data-line-number="21">    <span class="dt">fit3 =</span> fit3</a>
<a class="sourceLine" id="cb122-22" data-line-number="22">  )) <span class="op">+</span></a>
<a class="sourceLine" id="cb122-23" data-line-number="23"><span class="st">    </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> fit1, <span class="dt">color =</span> <span class="st">&quot;1&quot;</span>), <span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb122-24" data-line-number="24"><span class="st">    </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> fit2, <span class="dt">color =</span> <span class="st">&quot;2&quot;</span>), <span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb122-25" data-line-number="25"><span class="st">    </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> fit3, <span class="dt">color =</span> <span class="st">&quot;3&quot;</span>), <span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb122-26" data-line-number="26"><span class="st">    </span><span class="kw">scale_colour_manual</span>(</a>
<a class="sourceLine" id="cb122-27" data-line-number="27">      <span class="dt">name =</span> <span class="st">&quot;&quot;</span>,</a>
<a class="sourceLine" id="cb122-28" data-line-number="28">      <span class="dt">values =</span> <span class="kw">c</span>(</a>
<a class="sourceLine" id="cb122-29" data-line-number="29">        <span class="st">&quot;train&quot;</span> =<span class="st"> </span>cbp1[<span class="dv">1</span>],</a>
<a class="sourceLine" id="cb122-30" data-line-number="30">        <span class="st">&quot;1&quot;</span> =<span class="st"> </span>cbp1[<span class="dv">2</span>],</a>
<a class="sourceLine" id="cb122-31" data-line-number="31">        <span class="st">&quot;2&quot;</span> =<span class="st"> </span>cbp1[<span class="dv">3</span>],</a>
<a class="sourceLine" id="cb122-32" data-line-number="32">        <span class="st">&quot;3&quot;</span> =<span class="st"> </span>cbp1[<span class="dv">4</span>]</a>
<a class="sourceLine" id="cb122-33" data-line-number="33">      ),</a>
<a class="sourceLine" id="cb122-34" data-line-number="34">      <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;1&quot;</span> =<span class="st"> &quot;1st degree&quot;</span>, <span class="st">&quot;2&quot;</span> =<span class="st"> &quot;6th degree&quot;</span>, <span class="st">&quot;3&quot;</span> =<span class="st"> &quot;20th degree&quot;</span>)</a>
<a class="sourceLine" id="cb122-35" data-line-number="35">    ) <span class="op">+</span></a>
<a class="sourceLine" id="cb122-36" data-line-number="36"><span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">color =</span> <span class="st">&quot;train&quot;</span>),</a>
<a class="sourceLine" id="cb122-37" data-line-number="37">               <span class="dt">data =</span> data.train.df,</a>
<a class="sourceLine" id="cb122-38" data-line-number="38">               <span class="dt">show.legend =</span> <span class="ot">FALSE</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb122-39" data-line-number="39"><span class="st">    </span><span class="kw">ylab</span>(<span class="st">&quot;y&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb122-40" data-line-number="40"><span class="st">    </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">3</span>, <span class="dv">2</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb122-41" data-line-number="41"><span class="st">    </span><span class="kw">theme_minimal</span>()</a>
<a class="sourceLine" id="cb122-42" data-line-number="42"></a>
<a class="sourceLine" id="cb122-43" data-line-number="43">  p</a>
<a class="sourceLine" id="cb122-44" data-line-number="44">}</a></code></pre></div>
<p>Next we fit the polynomial models to four different training sets, generated from the same distribution.</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb123-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">42</span>)</a>
<a class="sourceLine" id="cb123-2" data-line-number="2"><span class="kw">grid.arrange</span>(<span class="kw">fit_plot</span>(), <span class="kw">fit_plot</span>(), <span class="kw">fit_plot</span>(), <span class="kw">fit_plot</span>(),</a>
<a class="sourceLine" id="cb123-3" data-line-number="3">             <span class="dt">nrow =</span> <span class="dv">2</span>)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:4fits"></span>
<img src="04-statisticalLearning_files/figure-html/4fits-1.png" alt="Polynomial fits to four different sets of training data, sampled from teh same distribution" width="80%" />
<p class="caption">
Figure 4.13: Polynomial fits to four different sets of training data, sampled from teh same distribution
</p>
</div>
<p>We see from the pictures that then 2nd degree polynomial fit does not change very much on the different training sets, while the 20th degree polynomial looks very different in the four pictures.</p>
Now let ut repeat this experiment many times, and only plot the mean and variance of <span class="math inline">\(h\)</span>.
<div class="figure" style="text-align: center"><span id="fig:polynomialFits"></span>
<img src="04-statisticalLearning_files/figure-html/polynomialFits-1.png" alt="Mean fit and 95% CI for the different polynomial regressions and bias variance decomposition" width="80%" />
<p class="caption">
Figure 4.14: Mean fit and 95% CI for the different polynomial regressions and bias variance decomposition
</p>
</div>
<p>From the pictures we see that the 4th degree polynomial has a small bias, but for 6h degree, the bias is close to 0. The error in the 4th degree polynomial is a sum of bias and variance, but for 6th and 8th the error is dominated by the variance term. The variance becomes larger as the degree of the polynomial becomes larger, while the bias is already 0 for 6th degree. Therefore, the total error, the sum of bias and variance, is smallest for a 6th degree polynomial. As before, we see that a very flexibel model will tend to overfit the data and may perform worse than a less flexible model.</p>
<p>Another way to see the same phenomena is to choose on point, here <span class="math inline">\(x=1.5\)</span> and plot the bias and variance as we vary the degree of the polynomial. We do this for sample size <span class="math inline">\(n=100\)</span> and <span class="math inline">\(n=10000\)</span>.</p>
<div class="figure" style="text-align: center"><span id="fig:errorVsDegree"></span>
<img src="04-statisticalLearning_files/figure-html/errorVsDegree-1.png" alt="Bias/Variance decomposition when varying the degree of the polynomial. Left picture with n = 100, right with n = 10000" width="80%" />
<p class="caption">
Figure 4.15: Bias/Variance decomposition when varying the degree of the polynomial. Left picture with n = 100, right with n = 10000
</p>
</div>
<p>From the pictures we see that the bias is decreasing and the variance is increasing, as the degree increases. In the left picture, <span class="math inline">\(n=100\)</span>, the minimum total error is at a degree around 3. When the sample size increases, in the right picture, we can fit a more complex model, and the minimum error is at a degree around 8.</p>
<p>We have seen that we also in the regression setting need to bound the model complexity so that we do not overfit the model. This can be done by choosing a small family of models <span class="math inline">\(\mathcal H\)</span>. In the above case this would mean limiting the degree of the polynomial. Another option, that we will explore here, is to include a regularization term in the loss function.</p>
<p>Recall that least squares regression minimizes the in-sample error:
<span class="math display">\[
E_{in} = \sum_{i=1}^n\left( y_i - \beta_0 - \sum_{i=1}^p \beta_j x_{ij} \right)^2.
\]</span>
Ridge regression instead minimizes
<span class="math display">\[
E_{in} + \lambda\sum_{i=1}^p \beta_j^2,
\]</span>
and the lasso minimizes
<span class="math display">\[
E_{in} + \lambda\sum_{i=1}^p | \beta_j |.
\]</span>
Here <span class="math inline">\(\lambda\)</span> is a tuning parameter that needs to be determined seperately. Ridge regression and lasso uses different penalty terms of model complexity, but the main idea is the same. Models with many and large parameters will be penalized in favor of less complex models. Compared to least squares regression, the estimates of <span class="math inline">\(\beta_j\)</span> will be smaller in ridge and lasso. I.e. the estimates will shrink towards zero. These methods are therefore sometimes called shrinkage methods. We know that the estimates in least squares regression are unbiased and shrinkage methods therefore introduce a bias. The hope is that the variance will decrease sufficiently, so that the total prediction error is smaller. Note that neither of these methods are scale invariant, however usually software will take care of this automatically.</p>
<p>Let us look at the same example above, this time with a degree 20 polynomial, but penalized with ridge and lasso.</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb124-1" data-line-number="1"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb124-2" data-line-number="2"><span class="kw">library</span>(gridExtra)</a>
<a class="sourceLine" id="cb124-3" data-line-number="3"><span class="kw">library</span>(glmnet)</a></code></pre></div>
<pre><code>## Loading required package: Matrix</code></pre>
<pre><code>## Loaded glmnet 4.0-2</code></pre>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb127-1" data-line-number="1">data.df &lt;-<span class="st"> </span><span class="kw">gen_data</span>(truth)</a>
<a class="sourceLine" id="cb127-2" data-line-number="2"></a>
<a class="sourceLine" id="cb127-3" data-line-number="3">model.ridge &lt;-<span class="st"> </span><span class="kw">glmnet</span>(<span class="kw">poly</span>(data.df<span class="op">$</span>x,<span class="dv">20</span>), data.df<span class="op">$</span>y, <span class="dt">alpha =</span> <span class="dv">0</span> )</a>
<a class="sourceLine" id="cb127-4" data-line-number="4">model.lasso &lt;-<span class="st"> </span><span class="kw">glmnet</span>(<span class="kw">poly</span>(data.df<span class="op">$</span>x,<span class="dv">20</span>), data.df<span class="op">$</span>y, <span class="dt">alpha =</span> <span class="dv">1</span> )</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:ridge"></span>
<img src="04-statisticalLearning_files/figure-html/ridge-1.png" alt="Coefficents as lambda is varied for ridge regression" width="80%" />
<p class="caption">
Figure 4.16: Coefficents as lambda is varied for ridge regression
</p>
</div>
<div class="figure" style="text-align: center"><span id="fig:lasso"></span>
<img src="04-statisticalLearning_files/figure-html/lasso-1.png" alt="Coefficients as lambda is varied for the lasso" width="80%" />
<p class="caption">
Figure 4.17: Coefficients as lambda is varied for the lasso
</p>
</div>
<p>In the pictures we see that the fitted coefficients decrese towards 0 as <span class="math inline">\(\lambda\)</span> increases. The main difference between the two methods is that in the ridge regression all coefficients are strictly positive for any finite <span class="math inline">\(\lambda\)</span>, while for the lasso coefficients become 0 when <span class="math inline">\(\lambda\)</span> is large. This difference may be important when model interpretability is important. That is, the lasso will produce a simple model where many variables can be disregarded. We also mention that the lasso and ridge rigression can, unlike unregularized least squares, handle the case <span class="math inline">\(p&gt;&gt;n\)</span>. There is a generalization of ridge and lasso called elastic net, where a parameter <span class="math inline">\(0\leq \alpha \leq 1\)</span> is introduced and the loss function is instead,
$$
E_{in} + ( _{i=1}^p | <em>j | + (1-) </em>{i=1}^p _j^2).</p>
<p>$$</p>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="4-7-bias-variance-decomposition.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="4-9-model-selection.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
